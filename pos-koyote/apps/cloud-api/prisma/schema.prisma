generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SyncEvent {
  id         String   @id @default(uuid()) @db.Uuid
  eventId    String   @unique @map("event_id")
  type       String
  occurredAt DateTime @map("occurred_at") @db.Timestamptz(6)
  source     String
  payload    Json
  status     String   @default("PENDING")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([occurredAt, eventId], name: "idx_sync_events_occurred")
  @@index([status], name: "idx_sync_events_status")
  @@map("sync_events")
}

model PosEventAck {
  posId     String   @map("pos_id")
  eventId   String   @map("event_id")
  appliedAt DateTime @default(now()) @map("applied_at") @db.Timestamptz(6)

  @@id([posId, eventId])
  @@index([posId], name: "idx_ack_pos")
  @@map("pos_event_ack")
}

model Order {
  id        String   @id @default(uuid()) @db.Uuid
  orderId   String   @unique @map("order_id")
  status    String
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  payload   Json

  @@map("orders")
}

model ReadModelInventory {
  productId         String   @id @map("product_id")
  slug              String?  @map("slug")
  available         Int      @default(0)
  updatedAt         DateTime @default(now()) @map("updated_at") @db.Timestamptz(6)
  displayName       String?  @map("display_name")
  shortDescription  String?  @map("short_description")
  imageUrl          String?  @map("image_url")
  category          String?
  price             Decimal? @map("price")
  game              String?
  availabilityState String?  @map("availability_state")
  lastSyncedAt      DateTime? @map("last_synced_at") @db.Timestamptz(6)
  isFeatured        Boolean  @default(false) @map("is_featured")
  featuredOrder     Int?     @map("featured_order")

  @@map("read_model_inventory")
}
